const a=document.body,b=document.getElementById('dropArea');a.addEventListener('dragover',c=>{c.preventDefault();c.dataTransfer.dropEffect='copy';b&&b.classList.add('dragover')});a.addEventListener('dragleave',c=>{b&&!a.contains(c.relatedTarget)&&b.classList.remove('dragover')});a.addEventListener('drop',c=>{c.preventDefault();b&&b.classList.remove('dragover');var d=c.dataTransfer.files;getFiles(d)});const getFiles=c=>{if(c.length===0)return;const d=c.length,e=document.getElementById('dropArea');e&&(e.innerHTML=`<div class="drop-text">âœ… ${d}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</div><div class="drop-subtext">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</div>`);let f=0;for(const g of c){const h=new FileReader;h.readAsText(g,'shift-jis');h.onload=i=>{let j=i.target.result;if(j.indexOf('ARC4 Manager Race Data')!==0&&j.indexOf('ARC4 Manager User List')!==0){const k=new FileReader;k.readAsText(g,'utf-8');k.onload=l=>{j=l.target.result;(j.indexOf('ARC4 Manager Race Data')==0||j.indexOf('ARC4 Manager User List')==0)&&(document.getElementById('ta').value=document.getElementById('ta').value+'\n'+j);f++;f===d&&e&&(e.innerHTML=`<div class="drop-text">âœ… ${d}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ</div><div class="drop-subtext">é›†è¨ˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦çµæœã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</div>`)};return}(j.indexOf('ARC4 Manager Race Data')==0||j.indexOf('ARC4 Manager User List')==0)&&(document.getElementById('ta').value=document.getElementById('ta').value+'\n'+j);f++;f===d&&e&&(e.innerHTML=`<div class="drop-text">âœ… ${d}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ</div><div class="drop-subtext">é›†è¨ˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦çµæœã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</div>`)};h.onerror=()=>{f++;f===d&&e&&(e.innerHTML=`<div class="drop-text">âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</div><div class="drop-subtext">ã‚‚ã†ä¸€åº¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„</div>`)}}};function switchDisplay(c){let d=document.getElementsByClassName("inputArea")[0],e=document.getElementById('btn');(d.style.display==='none'||c==1)?(d.style.display='block',e.innerHTML='ğŸ“Š å°åˆ·ç”¨è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆã‚‹'):(d.style.display='none',e.innerHTML='ğŸ“ å…¥åŠ›ç”»é¢ã«æˆ»ã‚‹')}function clear1(){document.getElementById('ta').value='';document.getElementById('table1').innerHTML='';const c=document.getElementById('postToXBtn');c&&(c.style.display='none');const d=document.getElementById('generateImageBtn');d&&(d.style.display='none');m=null;const e=document.getElementById('dropArea');e&&(e.innerHTML=`<div class="drop-text">ğŸ“ ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div><div class="drop-subtext">ARC4 Managerã®çµæœãƒ•ã‚¡ã‚¤ãƒ« (.csv ã¾ãŸã¯ .arc4) ã‚’æ”¾ã‚Šè¾¼ã‚“ã§ãã ã•ã„</div><div class="drop-subtext">è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€åº¦ã«ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™</div>`);switchDisplay(1)}function postToX(){if(!m){alert('æŠ•ç¨¿ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«é›†è¨ˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');return}const c=m;let d='';d+=`ğŸ ${c.title}\n`;c.mode==1?d+=`âš¡ ãƒ™ã‚¹ãƒˆãƒ©ãƒƒãƒ— ${c.style} ã‚¹ã‚¿ãƒ¼ãƒˆ\n\n`:d+=`ğŸƒ å‘¨å›ãƒ¬ãƒ¼ã‚¹ ${c.style} ã‚¹ã‚¿ãƒ¼ãƒˆ\n\n`;let e=0;for(let f=0;f<c.data.length&&e<3;f++){if(c.data[f][4]=="")continue;const g=e+1,h=c.data[f][3];let i='';g===1?i='ğŸ¥‡':g===2?i='ğŸ¥ˆ':g===3&&(i='ğŸ¥‰');if(c.mode==1){const j=c.data[f][7];j!=999999?d+=`${i}${g}ä½: ${h} ${msecToSec(j)}\n`:d+=`${i}${g}ä½: ${h} -\n`}else{const j=c.data[f][4],k=c.data[f][5];d+=`${i}${g}ä½: ${h} ${j}å‘¨ ${msecToMin(k)}\n`}e++}d+='\n#RCãƒ¬ãƒ¼ã‚¹';d.length>270&&(d=d.substring(0,250)+'...\n\n#RCãƒ¬ãƒ¼ã‚¹');const l='https://twitter.com/intent/tweet?text='+encodeURIComponent(d);window.open(l,'_blank','width=550,height=420')}function getVersionInfo(){const c=document.querySelectorAll('script[src*="jsdelivr.net"]');let d='RC-Race-Results-Generator (Local)';return c.forEach(e=>{const f=e.src,g=f.match(/jsdelivr\.net\/gh\/([^\/]+)\/([^\/]+)@([^\/]+)/);if(g){const[,h,i,j]=g;d=`${h}/${i}@${j}`}}),d}function generateImage(){const c=document.getElementById('table1');if(!c||!c.innerHTML){alert('å…ˆã«é›†è¨ˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');return}const d=document.getElementById('generateImageBtn'),e=d.innerHTML;d.innerHTML='ğŸ“· ç”»åƒç”Ÿæˆä¸­...';d.disabled=true;const f=getVersionInfo(),g=new Date().toLocaleString('ja-JP'),h=document.createElement('div');h.style.position='absolute';h.style.left='-9999px';h.style.top='0';h.style.width=c.offsetWidth+'px';h.style.backgroundColor='#ffffff';h.style.padding='20px';h.style.fontFamily="'ãƒ¡ã‚¤ãƒªã‚ª', 'Meiryo', sans-serif";const i=c.cloneNode(true);h.appendChild(i);const j=document.createElement('div');j.style.textAlign='right';j.style.marginTop='15px';j.style.fontSize='11px';j.style.color='#666';j.style.borderTop='1px solid #ddd';j.style.paddingTop='8px';j.innerHTML=`Generated by: ${f}<br>Date: ${g}`;h.appendChild(j);document.body.appendChild(h);const k={backgroundColor:'#ffffff',scale:2,useCORS:true,allowTaint:false,scrollX:0,scrollY:0,width:h.offsetWidth,height:h.offsetHeight};html2canvas(h,k).then(l=>{try{document.body.removeChild(h);const n=new Date,o=`race-results-${n.getFullYear()}${(n.getMonth()+1).toString().padStart(2,'0')}${n.getDate().toString().padStart(2,'0')}-${n.getHours().toString().padStart(2,'0')}${n.getMinutes().toString().padStart(2,'0')}.png`,p=document.createElement('a');p.download=o;p.href=l.toDataURL('image/png');document.body.appendChild(p);p.click();document.body.removeChild(p);d.innerHTML=e;d.disabled=false;setTimeout(()=>{alert('ç”»åƒã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\nXæŠ•ç¨¿ç”»é¢ã‚’é–‹ãã¾ã™...');m&&postToX()},500)}catch(n){console.error('ç”»åƒä¿å­˜ã‚¨ãƒ©ãƒ¼:',n);document.body.removeChild(h);d.innerHTML=e;d.disabled=false;alert('ç”»åƒä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚')}}).catch(l=>{console.error('html2canvasã‚¨ãƒ©ãƒ¼:',l);document.body.contains(h)&&document.body.removeChild(h);d.innerHTML=e;d.disabled=false;alert('ç”»åƒç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚')})}document.addEventListener('DOMContentLoaded',function(){const c=document.getElementById('repoInfo');c&&(c.textContent=getVersionInfo())});function calc1(c,d){let e=[],f=[];let g=document.getElementById('ta').value;if(g==''){alert('å…ˆã«ãƒ¬ãƒ¼ã‚¹çµæœãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ï¼ï¼');return}g=g.replace('\r\n','\n').trim();let h=g.split("\n");for(let i=0;i<h.length;++i)h[i]=h[i].split(",");console.log('CSVè§£æé–‹å§‹:',h);let j=[],k=[],l=0,n,o=[],p,q=[],r=0,s,t,u=document.getElementById('sb').value;for(let i=0;i<h.length;++i){if(l==1){if(h[i][0]=='ARC4 Manager Race Data'||h[i][0]=='ARC4 Manager User List'){l=0;continue}t=v;for(let w=1;w<r-v+1;++w){h[i][w]&&!isNaN(parseFloat(h[i][w]))&&k[t].push(parseFloat(h[i][w]));++t}}if(l==0&&!isNaN(parseInt(h[i][0]))&&h[i][1]&&!isNaN(parseFloat(h[i][1]))){if(j.length===0||!j[0]){v=0;r=0;for(let w=1;w<h[i].length;++w)if(h[i][w]&&!isNaN(parseFloat(h[i][w]))){let x="ãƒ‰ãƒ©ã‚¤ãƒãƒ¼"+w;u=="with"?j[r]=x+' (H:'+p+')':j[r]=x;k[r]=[];o[r]=n||1;q[r]=p||1;++r}}l=1;t=v;for(let w=1;w<r-v+1;++w){h[i][w]&&!isNaN(parseFloat(h[i][w]))&&k[t].push(parseFloat(h[i][w]));++t}}h[i][0]=="åå‰"&&(l=1,v=r,function(){for(let w=1;w<h[i].length;++w)if(h[i][w]){u=="with"?j[r]=h[i][w]+' (H:'+p+')':j[r]=h[i][w];k[r]=[];o[r]=n;q[r]=p;++r}}());if(h[i][0]=="ãƒãƒ³ãƒ‰"||(h[i][0]==""&&i>0&&h[i-1][0]=="ãƒãƒ³ãƒ‰")){if(h[i][0]=="ãƒãƒ³ãƒ‰"){v=r;for(let w=1;w<h[i].length;++w)if(h[i][w]&&h[i][w].trim()===""){let x="ãƒ‰ãƒ©ã‚¤ãƒãƒ¼"+w;u=="with"?j[r]=x+' (H:'+p+')':j[r]=x;k[r]=[];o[r]=n;q[r]=p;++r}}else h[i][0]==""&&h[i+1]&&!isNaN(parseFloat(h[i+1][1]))&&(l=1)}if(h[i][0]=="ã‚³ãƒ¼ã‚¹"&&i+2<h.length){let w=i+2;while(w<h.length&&(!h[w][1]||isNaN(parseFloat(h[w][1]))))w++;if(w<h.length&&!isNaN(parseFloat(h[w][1]))){v=r;for(let x=1;x<h[i].length;++x)if(x<20){let y="ãƒ‰ãƒ©ã‚¤ãƒãƒ¼"+x;u=="with"?j[r]=y+' (H:'+p+')':j[r]=y;k[r]=[];o[r]=n;q[r]=p;++r}i+1<h.length&&(h[i+1][0]==""||h[i+1][0]=="ãƒãƒ³ãƒ‰")&&i++}}h[i][0]=="ãƒ©ã‚¦ãƒ³ãƒ‰"&&(n=h[i][1]);h[i][0]=="ãƒ’ãƒ¼ãƒˆ"&&(p=h[i][1]);h[i][0]=="ãƒ¬ãƒ¼ã‚¹ã‚¿ã‚¤ãƒˆãƒ«"&&!e.includes(h[i][1])&&e.push(h[i][1]);h[i][0]=="ãƒ¬ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«"&&!f.includes(h[i][1])&&f.push(h[i][1])}var v;console.log('è§£æçµæœ:');console.log('ãƒ‰ãƒ©ã‚¤ãƒãƒ¼:',j);console.log('ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ :',k);console.log('ãƒ©ã‚¦ãƒ³ãƒ‰:',o);console.log('ãƒ’ãƒ¼ãƒˆ:',q);let z=[],A=[];for(let i=0;i<j.length;++i)j[i]&&(A[i]=[],A[i].push(o[i]),A[i].push(q[i]),A[i].push(i+1),A[i].push(j[i]),A[i]=A[i].concat(totallingPersonal(k[i],o[i],d)));c==1?(A=arrSort(A,1,9),A=arrSort(A,1,7)):(A=arrSort(A,1,9),A=arrSort(A,1,7),A=arrSort(A,1,5),A=arrSort(A,-1,4));let B=removeDuplicates(A);arrDisplayTable(B,c,d,e.join(' '),f.join(' '));switchDisplay();window.print()}function msecToMin(c){if(c==0)return"";let d=Math.floor(c/60000),e=(c%60000)/1000;if(c%1000==0)return d+":"+e+".000";e<10&&(e="0"+e);e=e+"000";return d+":"+e.slice(0,6)}function msecToSec(c){if(c==0)return"";if(c%1000==0)return c/1000+".000";if(c>=100000)return c=c/1000+"00",c.slice(0,7);return c=c/1000+"00",c.slice(0,6)}function totallingPersonal(c,d,e){let f=0,g=0,h=0,i="",j=999999,k=999999,l="",n="";for(let o=0;o<c.length;++o)if(!isNaN(c[o])){f=f+c[o];h=o+1;if(o>0||e==1){g=g+c[o];if(c[o]<j){k=j;n=l;j=c[o];l=String(d)+'-'+String(o+1)}else c[o]<k&&(k=c[o],n=String(d)+'-'+String(o+1))}}e==1?h>0&&(i=Math.round(f/h)):h>1&&(i=Math.round(g/(h-1)));return[h,f,i,j,l,k,n]}function arrSort(c,d,e){return c.sort(function(f,g){let h=f[e],i=g[e];return d*(h-i)}),c}function arrDisplay(c){let d=[];for(let e=0;e<c.length;++e)d.push(c[e].join('\t'));document.getElementById('ta2').value=d.join('\n')}function removeDuplicates(c){let d=structuredClone(c),e=[],f=[],g={},h=0;for(let i=0;i<d.length;++i)if(f.includes(d[i][3])){if(e[g[d[i][3]]][11]==''){e[g[d[i][3]]][11]=d[i][4];e[g[d[i][3]]][12]=d[i][5];e[g[d[i][3]]][13]=d[i][0];let j=[];j.push([e[g[d[i][3]]][7],e[g[d[i][3]]][8]]);j.push([e[g[d[i][3]]][9],e[g[d[i][3]]][10]]);j.push([d[i][7],d[i][8]]);j.push([d[i][9],d[i][10]]);j=arrSort(j,1,0);e[g[d[i][3]]][7]=j[0][0];e[g[d[i][3]]][8]=j[0][1];e[g[d[i][3]]][9]=j[1][0];e[g[d[i][3]]][10]=j[1][1]}}else{e[h]=d[i];e[h].push('');e[h].push('');e[h].push('');f[h]=d[i][3];g[d[i][3]]=h;++h}return e}let m=null;function arrDisplayTable(c,d,e,f,g){m={data:c,mode:d,mode2:e,title:f,style:g};let h=[],i=new Date,j=i.getFullYear()+'/'+(i.getMonth()+1)+'/'+i.getDate()+' '+i.getHours()+':'+i.getMinutes();h.push('<table>\n');h.push('<tr class="title"><td colspan="8"><div align="right">'+j+'</div></td></tr>\n');h.push('<tr class="title"><td colspan="8"><div align="left"><b><u>'+f+'</u></b></div></td></tr>\n');d==1?h.push('<tr class="title"><td colspan="8"><div align="left">ãƒ™ã‚¹ãƒˆãƒ©ãƒƒãƒ—ã€€'+g+' ã‚¹ã‚¿ãƒ¼ãƒˆ</div></td></tr>\n'):h.push('<tr class="title"><td colspan="8"><div align="left">å‘¨å›ãƒ¬ãƒ¼ã‚¹ã€€'+g+' ã‚¹ã‚¿ãƒ¼ãƒˆ</div></td></tr>\n');h.push('<tr>\n');h.push('<th></th>\n');h.push('<th></th>\n');h.push('<th colspan="3">1ä½</th>\n');h.push('<th colspan="3">2ä½</th>\n');h.push('</tr>\n');h.push('<tr>\n');h.push('<th>é †ä½</th>\n');h.push('<th>åå‰</th>\n');d==1?(h.push('<th>ãƒ™ã‚¹ãƒˆ</th>\n'),h.push('<th>Rd</th>\n'),h.push('<th>å‘¨</th>\n'),h.push('<th>ãƒ™ã‚¹ãƒˆ</th>\n'),h.push('<th>Rd</th>\n'),h.push('<th>å‘¨</th>\n')):(h.push('<th>å‘¨å›</th>\n'),h.push('<th>ã‚´ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ </th>\n'),h.push('<th>Rd.</th>\n'),h.push('<th>å‘¨å›</th>\n'),h.push('<th>ã‚´ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ </th>\n'),h.push('<th>Rd.</th>\n'));h.push('</tr>\n');for(let k=0;k<c.length;++k){if(c[k][4]=="")continue;h.push('<tr>\n');h.push('<td class="right">'+(k+1)+'</td>\n');h.push('<td              >'+c[k][3]+'</td>\n');if(d==1){let l=c[k][8].split('-'),n="",o="";l.length>1&&(n=l[0],o=l[1]);c[k][7]==999999?h.push('<td class="right"></td>\n'):h.push('<td class="right">'+msecToSec(c[k][7])+'</td>\n');h.push('<td class="right">'+n+'</td>\n');h.push('<td class="right">'+o+'</td>\n');l=c[k][10].split('-');n="";o="";l.length>1&&(n=l[0],o=l[1]);c[k][9]==999999?h.push('<td class="right"></td>\n'):h.push('<td class="right">'+msecToSec(c[k][9])+'</td>\n');h.push('<td class="right">'+n+'</td>\n');h.push('<td class="right">'+o+'</td>\n')}else{h.push('<td class="right">'+c[k][4]+'</td>\n');h.push('<td class="right">'+msecToMin(c[k][5])+'</td>\n');h.push('<td class="right">'+c[k][0]+'</td>\n');h.push('<td class="right">'+c[k][11]+'</td>\n');h.push('<td class="right">'+msecToMin(c[k][12])+'</td>\n');h.push('<td class="right">'+c[k][13]+'</td>\n')}h.push('</tr>\n')}h.push('</table>\n');document.getElementById('table1').innerHTML=h.join('');const p=document.getElementById('postToXBtn');p&&(p.style.display='inline-block',p.className='btn-success x-post');const q=document.getElementById('generateImageBtn');q&&(q.style.display='inline-block',q.className='btn-success')}
